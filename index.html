<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MagtanimAyDiBiro (MADB) - Welcome</title>
    <meta name="description" content="Step-by-step rice farming guidance and easy expense tracking for Bagabag farmers">
    <meta name="theme-color" content="#4a7c59">
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="css/main.css">
    <link rel="apple-touch-icon" href="icon-192x192.svg">
</head>
<body class="welcome-page">
    <div class="container">
        <div class="logo">ðŸŒ¾</div>
        <h1>MagtanimAyDiBiro</h1>
        <div class="tagline">
            Step-by-step rice farming guidance and easy expense trackingâ€”right on your phone.
        </div>
        <a href="farm-setup.html"><button class="start-btn">Start Now</button></a>
        <div class="footer">Empowering Bagabag farmers, one step at a time.</div>
    </div>

    <script src="js/db.js"></script>
    <script>
        // Check if there are existing farms and redirect to dashboard if found
        async function checkForExistingFarms() {
            try {
                // Ensure IndexedDBStorage is available
                if (!window.IndexedDBStorage) {
                    console.log('[Index] Database not ready, showing welcome page');
                    return;
                }
                
                // Wait for database to initialize
                await IndexedDBStorage.initDB();
                
                // Check for existing farms
                const farms = await IndexedDBStorage.getAllFarms();
                
                // Also check for legacy farmInfo for backward compatibility
                const legacyFarm = await MADBStorage.getItem('farmInfo');
                
                if (farms.length > 0 || legacyFarm) {
                    // Redirect to dashboard if farms exist
                    window.location.href = 'dashboard.html';
                    return;
                }
                
                // If no farms exist, show the welcome page (already visible)
            } catch (error) {
                console.error('Error checking for existing farms:', error);
                // On error, show welcome page anyway
            }
        }

        // Run check when page loads
        document.addEventListener('DOMContentLoaded', () => {
            checkForExistingFarms();
        });

        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                if (location.hostname === '127.0.0.1' || location.hostname === 'localhost') {
                    console.log('[PWA] Skipping service worker registration in development');
                    return;
                }
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('[PWA] Service Worker registered:', registration);
                    })
                    .catch(error => {
                        console.error('[PWA] Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html> 